{% extends 'base.html' %}
{% block title %}قوائم المزادات{% endblock %}

{% block extra_head %}
    <!-- يمكن وضع المحتوى الإضافي لرأس الصفحة المحدد لصفحة المزاد هنا -->
{% endblock %}

{% block body %}
<!-- قائمة الفئات المستقلة -->
<nav class="category-listing">
    {% for category in categories %}
    <a href="#{{ category }}">{{ category }}</a>
    {% endfor %}
</nav>

<div class="main-body">
    <!-- العناصر المدرجة حسب الوقت المتبقي -->
    {% for item in items %}
    <div class="auction-item" data-end-time="{{ item.end_time_iso }}">
        <img src="{{ item.img }}" alt="{{ item.name }}">
        <div class="auction-details">
            <h3>{{ item.name }}</h3>
            <p class="time-left">الوقت المتبقي: <span>{{ item.time_left }}</span></p>
            <p>المزايدة الابتدائية: $<span class="start-bid">{{ item.start_bid }}</span></p>
            <p>الفئة: {{ item.category }}</p>
            <p>الحالة: {{ item.condition }}</p>
            <p>الموقع: {{ item.location }}</p>
            <!-- Add the Bid button -->
            <!-- Add the Bid form -->
            <form action="{{ url_for('place_bid', item_id=item.id) }}" method="post">
                <input type="number" name="bid_amount" placeholder="حط كم بتزود" required>
                <button type="submit">مزايدة</button>
            </form>
            <a href="{{ url_for('item_details', item_id=item.id) }}">تفاصيل العنصر</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    function updateAuctionTimes() {
        var items = document.querySelectorAll('.auction-item');
        items.forEach(function(item) {
            var endTime = new Date(item.getAttribute('data-end-time'));
            var now = new Date();
            var timeLeft = endTime - now;

            // Check if the auction has ended
            if (timeLeft <= 0) {
                var display = item.querySelector('.time-left span');
                if (display) {
                    display.textContent = "المزاد انتهى";
                }
            } else {
                // Calculate the remaining time
                var seconds = Math.floor(timeLeft / 1000);
                var minutes = Math.floor(seconds / 60);
                var hours = Math.floor(minutes / 60);
                var days = Math.floor(hours / 24);

                hours %= 24;
                minutes %= 60;
                seconds %= 60;

                var timeString = `${days} يوم ${hours} ساعة ${minutes} دقيقة ${seconds} ثانية`;

                // Update the display with the remaining time
                var display = item.querySelector('.time-left span');
                if (display) {
                    display.textContent = timeString;
                }
            }
        });
    }

    // Update auction times initially
    updateAuctionTimes();

    // Update auction times every second
    setInterval(updateAuctionTimes, 1000);
});
</script>
{% endblock %}